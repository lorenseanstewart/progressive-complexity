---
import htmxUrl from "htmx.org/dist/htmx.min.js?url";
import hxOptimisticUrl from "hx-optimistic/hx-optimistic.min.js?url";
import UserWelcome from "../components/UserWelcome.astro";

const { title = "Progressive Complexity Demo", enableHtmx = true } =
  Astro.props as {
    title?: string;
    enableHtmx?: boolean;
  };
---

<!doctype html>
<html
  lang="en"
  data-theme="pastel"
>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width"
    />
    <meta
      name="description"
      content="A demo of progressive complexity"
    />
    <title>{title}</title>
    {
      enableHtmx && (
        <meta
          name="htmx-config"
          content='{"useTemplateFragments":true}'
        />
      )
    }
    {enableHtmx && <script src={htmxUrl} />}
    {enableHtmx && <script src={hxOptimisticUrl} />}
    <script>
      import "../lib/page-utils.ts";
    </script>
  </head>
  <body class="min-h-screen bg-base-100">
    <UserWelcome />
    <div class="container mx-auto p-6 max-w-7xl">
      <slot />
    </div>
    <template id="hxopt-tpl-price">
      <span
        class="view optimistic-update"
        id={"view-price-" + "${data:id}"}
        tabindex="0"
        aria-live="polite"
        aria-atomic="true"
        onclick={`
          window.pageUtils.toggleEdit(${"${data:id}"}, true, 'price')
        `}
        onkeydown={`
          if (event.key === 'Enter' || event.key === ' ') {
            window.pageUtils.toggleEdit(${"${data:id}"}, true, 'price');
            event.preventDefault();
          }
        `}
        >{"${this.value}"}</span
      >
    </template>
    <template id="hxopt-tpl-price-error">
      <span
        class="view text-error"
        id={"view-price-" + "${data:id}"}
        >Error</span
      >
    </template>
    <template id="hxopt-tpl-qty">
      <span
        class="view optimistic-update"
        id={"view-qty-" + "${data:id}"}
        tabindex="0"
        aria-live="polite"
        aria-atomic="true"
        onclick={`
          window.pageUtils.toggleEdit(${"${data:id}"}, true, 'quantity')
        `}
        onkeydown={`
          if (event.key === 'Enter' || event.key === ' ') {
            window.pageUtils.toggleEdit(${"${data:id}"}, true, 'quantity');
            event.preventDefault();
          }
        `}
        >{"${this.value}"}</span
      >
    </template>
    <template id="hxopt-tpl-qty-error">
      <span
        class="view text-error"
        id={"view-qty-" + "${data:id}"}
        >Error</span
      >
    </template>
  </body>
</html>

<style is:global>
  @tailwind base;
  @tailwind components;
  @tailwind utilities;

  /* Animation for delete action */
  .fade-out {
    animation: fade-out 0.5s ease-out forwards;
  }

  @keyframes fade-out {
    0% {
      @apply opacity-100 translate-x-0;
      height: auto;
    }
    50% {
      @apply opacity-50 -translate-x-5;
    }
    100% {
      @apply opacity-0 -translate-x-12;
      height: 0;
      padding: 0;
      margin: 0;
      border: none;
    }
  }

  /* Error container styling - uses DaisyUI error color */
  .error-container {
    @apply text-error text-xs font-semibold bg-red-50 border-2 border-error rounded p-2 mt-1 hidden;
  }

  .error-container:not(:empty) {
    @apply block;
  }

  /* Text alignment helper */
  .right {
    @apply text-right;
  }

  /* Optimistic update visual feedback */
  .optimistic-update {
    @apply text-secondary !important;
    transition: color 0.3s ease;
  }
</style>
